<!-- card-box -->
<article class="card-box">
  <div class="card-header">
    <h2 class="card-title"><%= __("vulnerability|Assets") %></h2>
  </div>
  <div class="card-body">
    <!-- card-content -->
    <div class="card-content">
      <!-- search-area -->
			<div class="search-area">
        <div class="ui-select default-style medium-size" data-width="200px">
          <select name="" id="assetTime">
            <option value="1"><%= __("vulnerability|Today") %></option>
            <option value="7" selected><%= __("vulnerability|Last 7day") %></option>
            <option value="30"><%= __("vulnerability|Last 30day") %></option>
          </select>
				</div>
			</div>
			<!-- //.search-area -->
      <div class="pack">
        <!-- table-comp -->
				<div class="table-comp">
					<div class="table-scroll default-style">
						<div class="thead-scroll">
							<table class="table default-style">
								<caption><span class="sr-only"><%= __("vulnerability|AssetList") %></span></caption>
								<colgroup>
                  <col style="width: 12%; " /><!-- Processed time -->
                  <col style="width: 18%; " /><!-- Asset name -->
                  <col style="width: 14%; " /><!-- Asset IP -->
                  <col style="width: 12%; " /><!-- Asset type -->
                  <col style="width: 16%; " /><!-- Asset manufacturer -->
                  <col style="width: 16%; " /><!-- Sensor name -->
                  <col style="width: 12%; " /><!-- Allow/Deny -->
								</colgroup>
								<thead>
                  <tr>
                    <th scope="row"><%= __("vulnerability|Processed time") %></th>
                    <th scope="row"><%= __("vulnerability|Asset name") %></th>
  				          <th scope="row"><%= __("vulnerability|Asset IP") %></th>
                    <th scope="row"><%= __("vulnerability|Asset type") %></th>
                    <th scope="row"><%= __("vulnerability|Asset manufacturer") %></th>
                    <th scope="row"><%= __("vulnerability|Sensor name") %></th>
                    <th scope="row"><%= __("vulnerability|Allow Deny") %></th>
  				        </tr>
								</thead>
							</table>
						</div>
					  <div class="tbody-scroll">
				  		<table class="table default-style">
								<caption><span class="sr-only"><%= __("vulnerability|AssetList") %></span></caption>
								<colgroup>
                  <col style="width: 12%; " /><!-- Processed time -->
                  <col style="width: 18%; " /><!-- Asset name -->
                  <col style="width: 14%; " /><!-- Asset IP -->
                  <col style="width: 12%; " /><!-- Asset type -->
                  <col style="width: 16%; " /><!-- Asset manufacturer -->
                  <col style="width: 16%; " /><!-- Sensor name -->
                  <col style="width: 12%; " /><!-- Allow/Deny -->
								</colgroup>
								<tbody>
                  <% for (let i = 0; i < ObjView.length; i++) { %>
                  <% const data = ObjView[i] %>
									<tr data-asset_id="<%= data.idx %>" data-sensor_id="<%= data.sensor_id %>">
                    <td class="cell-center"><%= dateFormat(data.detection_time) %></td>
                    <td class="cell-center cell-link" data-link><%= data.asset_name %></td>
                    <td class="cell-center"><%= data.asset_ip %></td>
                    <td><%= data.asset_type %></td>
                    <td><%= data.asset_manufacturer %></td>
                    <td><%= data.sensor_name %></td>
                    <td class="cell-center">
                      <% if (data.allowed == 0){ %><%= __("vulnerability|Denied") %>
                      <% } else { %><%= __("vulnerability|Allowed") %><% } %>
                    </td>
                  </tr>
                  <% } %>
                </tbody>
					    </table>
              <% if (ObjView.length == 0) { %>
              <!-- empty -->
              <div class="empty">
                <div class="empty-box">
                  <div class="symbol symbol-empty">
                    <span class="symbol-icon question-style"></span>
                    <div class="symbol-figure empty-style"></div>
                  </div>
                  <p class="main-msg"><%= __("vulnerability|No data available") %></p>
                  <p class="sub-msg"><%= __("vulnerability|There is no data to show you right now.") %></p>
                </div>
              </div>
              <!-- //empty -->
              <% } %>
					  </div>
					</div>
				</div>
				<!-- //table-comp -->
      </div>
      <div class="table-bottom">
        <div class="table-bottom-right">
          <%- include ('../../../views/include/pagination.ejs', {pages: pages, current: current}) %>
          <div class="ui-select default-style">
				    <select name="" id="assetEntries">
			        <option value="10" selected><%= __("vulnerability|Show 10 entries") %></option>
			        <option value="20"><%= __("vulnerability|Show 20 entries") %></option>
			        <option value="30"><%= __("vulnerability|Show 30 entries") %></option>
				    </select>
					</div>
        </div>
      </div>
    </div>
    <!-- //card-content -->
  </div>
</article>
<!-- //card-box -->

<script>
  logdata('/vulnerability/vulnerability/vulnerabilityAsset', <%- JSON.stringify(locals) %>);
</script>

<script>
  maintainState();
</script>

<script>
  selectDropdown('.ui-select');
  formWidth();
</script>

<script>
  // entries 변경
  $('#assetTime').off('change.assetTime').on('change.assetTime', function(){
    const asset_id = location.href.split('/')[location.href.split('/').length-1];
    const page = 1;
    const entries = $('#assetEntries option:selected').val() || 10;
    const time = $(this).find('option:selected').val() || 7;
    setState({assetPage: page, assetTime: time});
    requestAsset(asset_id, page, entries, time);
  });

  // entries 변경
  $('#assetEntries').off('change.assetEntries').on('change.assetEntries', function(){
    const asset_id = location.href.split('/')[location.href.split('/').length-1];
    const page = 1;
    const entries = $(this).find('option:selected').val() || 10;
    const time = $('#assetTime').find('option:selected').val() || 7;
    setState({assetPage: page, assetEntries: entries});
    requestAsset(asset_id, page, entries, time);
  });


  // pagination 변경
  $('#pagination .page-link').off('click.pagination').on('click.pagination', function(e){
    e.preventDefault();
    const asset_id = location.href.split('/')[location.href.split('/').length-1];
    const page = $(this).closest('.page-item').data('page') || 1;
    const entries = $('#assetEntries option:selected').val() || 10;
    const time = $('#assetTime').find('option:selected').val() || 7;
    setState({assetPage: page});
    requestAsset(asset_id, page, entries, time);
  });
</script>

<script>
  $('#assetList tbody [data-link]').off('click.go_asset').on('click.go_asset', function(){
    const $tr = $(this).closest('tr');
    const asset_id = $tr.data('asset_id');
    const sensor_id = $tr.data('sensor_id');
    const fuzz_id = location.href.split('/')[location.href.split('/').length-1].split('?')[0];
    location.href = '/asset/detection/assetDetail/' + asset_id + '?sensor_id=' + sensor_id + '&' + 'fuzz_id=' + fuzz_id;
  });
</script>
